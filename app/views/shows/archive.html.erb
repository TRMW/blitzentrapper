<% title "Shows" %>

<div id="shows-container" class="archive-page">

<%= render :partial => 'shownav' %>

<div id="shows">
	
	<div class="show">
  <div class="year left">
  	<% for currentyear in @years do %>
  	
  	<%- if currentyear.to_i == @year && currentyear.to_i != 2010 -%>
		<h3 class="currentyear"><%= link_to_unless_current currentyear, :controller => "shows", :action => "year", :year => currentyear %></h3>
		
		<%- else %>
		<h3><%= link_to_unless_current currentyear, :controller => "shows", :action => "year", :year => currentyear %></h3>
		<%- end -%>
		
		<%- if currentyear.to_i == @year %>
		<div class="months">
			<% @months.each do |month| %>
				<% date = Date.new(@year, month.to_i) %>
				<%- unless Show.by_month(date).blank? || date >= Date.today -%>
					<strong>
					<%= link_to_unless_current date.strftime('%B'), :controller => "shows", :action => "month", :month => date.strftime('%m') %>
					</strong>
				<%- end -%>
			<%- end -%>
		</div>
		<% end %>
		<% end %>
	</div>
  	
	<% for show in @shows %>
	<%- unless show.date >= Date.today -%>
  	<div class="right">
	    <h3><%= link_to show.venue, show %></h3><%= if !show.songs.blank? then content_tag :span, 'setlist!', :class => 'yellow' end %>
		  <div><span class="city"><%= show.city %>, <%= show.region %></span> <%= show.date.strftime('%B %d') %></div>
		  <span class="showmeta">
	    <%= if !show.posts.blank? then 'last comment ' + time_ago_in_words(show.posts.last.created_at) + ' ago by ' + show.posts.last.user.name end %>
		  </span>
		</div>
	<% end %>
  <% end %>
  </div>
  </div>
  
</div>
