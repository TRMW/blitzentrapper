<% title "Shows" %>

<div id="shows" class="archive-page">

<div id="archive-nav">
<%= link_to_unless_current "Future", shows_path %> - 
<%= link_to_unless_current "Past", archive_index_path %>
</div>
	
	<div class="show">
  <div class="year left">
  	<% 2009.downto(2007).each do |year| %>
  	<%- if year == @year && year != 2009 -%>
		<h3 class="currentyear"><%= link_to_unless_current year, :controller => "shows", :action => "year", :year => year %></h3>
		<%- else %>
		<h3><%= link_to_unless_current year, :controller => "shows", :action => "year", :year => year %></h3>
		<%- end -%>
		
		<%- if year == @year %>
		<div class="months">
			<% 1.upto(12).each do |month| %>
				<% date = Date.new(@year, month) %>
				<%- unless Show.by_month(date).blank? || date >= Date.today -%>
					<strong>
					<%= link_to_unless_current date.strftime('%B'), :controller => "shows", :action => "month", :month => date.strftime('%m') %>
					</strong>
				<%- end -%>
			<%- end -%>
		</div>
		<% end %>
		<% end %>
	</div>
  	
	<% for show in @shows %>
	<%- unless show.date >= Date.today -%>
  	<div class="right">
	    <h3><%= link_to show.venue, show %></h3>
		  <span class="city"><%= show.city %>, <%= show.region %></span> <%= show.date.strftime('%B %d') %>
		  <span class="showmeta">
	    <%= if !show.posts.blank? then content_tag :em, 'last comment ' + time_ago_in_words(show.posts.last.created_at) + ' ago by ' + show.posts.last.user.name end %>
	    <%= if !show.setlistings.blank? then content_tag :em, 'setlist updated ' + time_ago_in_words(show.setlistings.last.updated_at), :class => "setlist" end %>
		  </span>
		</div>
	<% end %>
  <% end %>
  </div>
  </div>
  
</div>
