<% title "Show Archive - #{@year}" %>

<%- content_for :subnav do -%>
  <%= render partial: "show_nav" %>

  <div class="header__subnav header__subnav--grid">
    <% for year in @years do %>
      <%= link_to_unless_current year, :controller => "shows", :action => "year", :year => year %>
    <% end %>
  </div>
<%- end -%>

<h1><%= @year %></h1>

<% if @shows_months.empty? %>
  <p>Woops, looks like we haven"t played any shows (yet!!) in <strong><%= @year %></strong>. Try selecting a different year on the left.</p>
<% else %>
  <% @shows_months.sort.each do |month, shows| %>
    <h2><%= month.strftime("%B") %></h2>

    <div class="shows-table">
      <% for show in shows %>
        <div class="shows-table__show">
          <div class="shows-table__show__cell shows-table__show__cell--venue">
            <strong><%= link_to show.venue, show %></strong>
            <% if !show.songs.blank? %>
              <span class="callout">setlist!</span>
            <% end %>
            <% if !show.notes.blank? %>
              <div>
                <%= show.notes %>
              </div>
            <% end %>
            <% if !show.posts.blank? %>
              <div>
                <em>last comment <%= time_ago_in_words(show.posts.last.created_at) %> ago by <%= show.posts.last.user.name %></em>
              </div>
            <% end %>
          </div>
          <div class="shows-table__show__cell">
            <% if show.enddate? %>
              <%= show.date.strftime("%A, %b %d") %><br> -
              <%= show.enddate.strftime("%A, %b %d") %>
            <%- else -%>
              <%= show.date.strftime("%A, %b %d") %>
            <% end %>
          </div>
          <div class="shows-table__show__cell">
            <strong><%= show.city %>, <%= show_state_or_country(show) %></strong>
          </div>
          <% if is_admin %>
            <div class="shows-table__show__cell">
              <%= link_to "Edit", edit_show_path(show) %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>
