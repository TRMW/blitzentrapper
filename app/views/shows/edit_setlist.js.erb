$("#setlist_link").html("<%= escape_javascript(link_to 'cancel', cancel_setlist_path(@show.id), :remote => true, :'data-type' => 'script') %>");
$("#tracks").html("<%= escape_javascript(render :partial => 'edit_setlist') %>");

$(".edit-link").on('click', function() {
  $link = $(this);
  trackId = $link.data('track-id');
  $link.text($link.text() == 'write in' ? 'select' : 'write in');
  $("#show_setlistings_attributes_" + trackId + "_song_id").toggle();
  $("#show_setlistings_attributes_" + trackId + "_song_attributes_title").toggle();
  return false;
});

$("#setlistings").sortable({
  handle: '.handle',
  stop: function() {
    $(this).find(".setlisting").each(function(i) {
        $(this).find("input[id$='_position']").attr("value",i+1);
        if ($(this).nextUntil(".setlisting").hasClass("encore")) {
          $("#show_encore").attr("value",i+1);
        }
    });
  }
});
